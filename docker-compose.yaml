# Definizione del modello per i servizi di backend (senza build)
x-backend-service: &backend-service
  image: dieti25estates/dietiestates25:backend
  restart: unless-stopped
  env_file:
    - ./backend/.env

services:
  # --- SERVIZIO FRONTEND ---
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    image: dieti25estates/dietiestates25:frontend
    ports:
      - "80:80"
    restart: unless-stopped

  # --- SERVIZI BACKEND ---
  # Solo auth-service costruisce l'immagine backend
  auth-service:
    <<: *backend-service
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      - SERVICE=auth
      - PORT=3001
    ports:
      - "3001:3001"

  # Gli altri servizi riutilizzano l'immagine
  property-service:
    <<: *backend-service
    environment:
      - SERVICE=property
      - PORT=3002
    ports:
      - "3002:3002"

  search-service:
    <<: *backend-service
    environment:
      - SERVICE=search
      - PORT=3003
    ports:
      - "3003:3003"

  notification-service:
    <<: *backend-service
    environment:
      - SERVICE=notification
      - PORT=3004
    ports:
      - "3004:3004"

  # --- WORKERS BACKEND ---
  email-worker:
    <<: *backend-service
    environment:
      - SERVICE=email-worker

  property-matcher-worker:
    <<: *backend-service
    environment:
      - SERVICE=property-matcher-worker