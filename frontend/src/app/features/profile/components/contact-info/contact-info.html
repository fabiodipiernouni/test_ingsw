<div class="contact-info-container">
  <!-- Section Header -->
  <div class="section-header">
    <h2>
      <mat-icon>contact_phone</mat-icon>
      Informazioni di Contatto
    </h2>
    <p>Gestisci il tuo numero di telefono e indirizzo email. L'email deve essere verificata per ricevere notifiche importanti.</p>
  </div>

  <!-- Contact Information Form -->
  <form [formGroup]="contactForm" (ngSubmit)="onSubmit()" class="contact-form">
    
    <!-- Phone Section -->
    <div class="form-section">
      <h3>
        <mat-icon>phone</mat-icon>
        Numero di Telefono
      </h3>
      <p class="section-description">
        Il tuo numero di telefono può essere utilizzato per contatti diretti e notifiche SMS.
      </p>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Numero di Telefono</mat-label>
        <input matInput 
               type="tel"
               formControlName="phone"
               placeholder="+39 123 456 7890">
        <mat-icon matSuffix>phone</mat-icon>
        <mat-error>
          {{ getFieldErrorMessage('phone') }}
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Email Section -->
    <div class="form-section">
      <h3>
        <mat-icon>email</mat-icon>
        Indirizzo Email
      </h3>
      <p class="section-description">
        Il tuo indirizzo email è utilizzato per l'accesso e per ricevere notifiche importanti.
      </p>
      
      <div class="email-field-container">
        <mat-form-field appearance="outline" class="email-input">
          <mat-label>Indirizzo Email</mat-label>
          <input matInput 
                 type="email"
                 formControlName="email"
                 placeholder="example@domain.com">
          <mat-icon matSuffix>email</mat-icon>
          <mat-error>
            {{ getFieldErrorMessage('email') }}
          </mat-error>
        </mat-form-field>
        
        <div class="email-status">
          @if (user.isVerified) {
            <div class="verification-status verified">
              <mat-icon>verified</mat-icon>
              <span>Verificata</span>
            </div>
          } @else {
            <div class="verification-status not-verified">
              <mat-icon>warning</mat-icon>
              <span>Non verificata</span>
            </div>
            <button type="button" 
                    mat-raised-button 
                    color="accent"
                    class="verify-button"
                    [disabled]="isEmailVerificationLoading()"
                    (click)="sendEmailVerification()">
              @if (isEmailVerificationLoading()) {
                <mat-icon class="spin">refresh</mat-icon>
              } @else {
                <mat-icon>send</mat-icon>
              }
              Invia Verifica
            </button>
          }
        </div>
      </div>
    </div>

    <!-- Email Verification Section -->
    @if (showEmailVerification()) {
      <div class="form-section email-verification-section">
        <h4>
          <mat-icon>security</mat-icon>
          Verifica Email
        </h4>
        <p class="section-description">
          @if (otpSent()) {
            Abbiamo inviato un codice di verifica di 6 cifre al tuo indirizzo email. Inseriscilo qui sotto per confermare la tua email.
          } @else {
            Per verificare la tua email, dovrai inserire un codice di verifica che riceverai via email.
          }
        </p>
        
        <form [formGroup]="emailVerificationForm" (ngSubmit)="verifyEmail()" class="verification-form">
          <div class="verification-input-row">
            <mat-form-field appearance="outline" class="otp-input">
              <mat-label>Codice di Verifica</mat-label>
              <input matInput 
                     type="text"
                     formControlName="otpCode"
                     placeholder="123456"
                     maxlength="6">
              <mat-icon matSuffix>vpn_key</mat-icon>
              <mat-error>
                {{ getFieldErrorMessage('otpCode', emailVerificationForm) }}
              </mat-error>
            </mat-form-field>
            
            <div class="verification-actions">
              <button type="submit" 
                      mat-raised-button 
                      color="primary"
                      [disabled]="isEmailVerificationLoading() || emailVerificationForm.invalid">
                @if (isEmailVerificationLoading()) {
                  <mat-icon class="spin">refresh</mat-icon>
                } @else {
                  <mat-icon>check</mat-icon>
                }
                Verifica
              </button>
              
              <button type="button" 
                      mat-button
                      (click)="cancelEmailVerification()">
                Annulla
              </button>
            </div>
          </div>
        </form>
      </div>
    }

    <!-- Form Actions -->
    <div class="form-actions">
      <button type="button" 
              mat-button
              [disabled]="isLoading()"
              (click)="contactForm.reset({ phone: user.phone, email: user.email })">
        <mat-icon>refresh</mat-icon>
        Ripristina
      </button>
      
      <button type="submit" 
              mat-raised-button 
              color="primary"
              [disabled]="isLoading() || contactForm.invalid || !contactForm.dirty">
        @if (isLoading()) {
          <mat-icon class="spin">refresh</mat-icon>
        } @else {
          <mat-icon>save</mat-icon>
        }
        Salva Modifiche
      </button>
    </div>

  </form>
</div>