<div class="personal-data-container">
  <form [formGroup]="personalDataForm" (ngSubmit)="onSubmit()">
    
    <div class="section-header">
      <h2>
        <mat-icon>person</mat-icon>
        Informazioni Personali
      </h2>
      <p>Gestisci i tuoi dati personali e informazioni professionali</p>
    </div>

    <!-- Basic Information -->
    <div class="form-section">
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Nome</mat-label>
          <input matInput 
                 formControlName="firstName" 
                 placeholder="Il tuo nome"
                 autocomplete="given-name">
          <mat-icon matSuffix>person</mat-icon>
          <mat-error>{{ getErrorMessage('firstName') }}</mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Cognome</mat-label>
          <input matInput 
                 formControlName="lastName" 
                 placeholder="Il tuo cognome"
                 autocomplete="family-name">
          <mat-icon matSuffix>person</mat-icon>
          <mat-error>{{ getErrorMessage('lastName') }}</mat-error>
        </mat-form-field>
      </div>
    </div>

    <!-- Agent Biography Section -->
    @if (isAgent()) {
      <div class="form-section">
        <h3>
          <mat-icon>work</mat-icon>
          Informazioni Professionali
        </h3>
        
        <div class="form-row">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Biografia Professionale</mat-label>
            <textarea matInput 
                      formControlName="biography" 
                      placeholder="Descrivi la tua esperienza professionale, le tue competenze e ciò che ti contraddistingue come agente immobiliare..."
                      rows="6"
                      maxlength="1000">
            </textarea>
            <mat-hint align="end">{{ personalDataForm.get('biography')?.value?.length || 0 }}/1000</mat-hint>
            <mat-error>{{ getErrorMessage('biography') }}</mat-error>
          </mat-form-field>
        </div>

        <!-- Specializations -->
        <div class="specializations-section">
          <h4>
            <mat-icon>work_outline</mat-icon>
            Specializzazioni
          </h4>
          <p class="section-description">
            Aggiungi le tue aree di specializzazione per aiutare i clienti a trovarti più facilmente
          </p>
          
          <div class="add-specialization">
            <mat-form-field appearance="outline" class="spec-input">
              <mat-label>Aggiungi specializzazione</mat-label>
              <input matInput 
                     [(ngModel)]="newSpecialization"
                     [ngModelOptions]="{standalone: true}"
                     placeholder="es. Immobili di lusso, Case vacanze, Uffici..."
                     (keydown)="onSpecializationKeyDown($event)">
            </mat-form-field>
            
            <button mat-icon-button 
                    type="button"
                    color="primary"
                    (click)="addSpecialization()"
                    [disabled]="!newSpecialization().trim()">
              <mat-icon>add</mat-icon>
            </button>
          </div>

          <div class="specializations-list">
            @if (specializations().length > 0) {
              <div class="specializations-grid">
                @for (spec of specializations(); track $index) {
                  <mat-chip 
                    class="specialization-chip"
                    (removed)="removeSpecialization($index)">
                    {{ spec }}
                    <mat-icon matChipRemove>cancel</mat-icon>
                  </mat-chip>
                }
              </div>
            } @else {
              <div class="empty-state">
                <mat-icon>info_outline</mat-icon>
                <p>Nessuna specializzazione aggiunta</p>
                <span>Aggiungi le tue specializzazioni per aiutare i clienti a trovarti</span>
              </div>
            }
          </div>
        </div>
      </div>
    }

    <!-- Actions -->
    <div class="form-actions">
      <button mat-button 
              type="button" 
              (click)="onReset()"
              [disabled]="isLoading()">
        <mat-icon>refresh</mat-icon>
        Ripristina
      </button>

      <button mat-raised-button 
              color="primary" 
              type="submit"
              [disabled]="!personalDataForm.valid || isLoading()">
        @if (isLoading()) {
          <ng-container>
            <mat-icon class="spin">refresh</mat-icon>
            Aggiornamento...
          </ng-container>
        } @else {
          <ng-container>
            <mat-icon>save</mat-icon>
            Salva Modifiche
          </ng-container>
        }
      </button>
    </div>
  </form>
</div>