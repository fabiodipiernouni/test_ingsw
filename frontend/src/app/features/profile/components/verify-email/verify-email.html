<div class="verify-email-container">
  <mat-card class="verify-email-card">
    <mat-card-header>
      <div class="header-content">
        <mat-icon class="header-icon">email</mat-icon>
        <div>
          <mat-card-title>Verifica Email</mat-card-title>
          <mat-card-subtitle>Conferma il tuo indirizzo email per accedere a tutte le funzionalità</mat-card-subtitle>
        </div>
      </div>
    </mat-card-header>

    <mat-card-content>
      @if (isEmailVerified) {
        <!-- Email già verificata -->
        <div class="verified-status">
          <div class="success-icon">
            <mat-icon>check_circle</mat-icon>
          </div>
          <h3>Email Verificata</h3>
          <p>La tua email <strong>{{ currentUser?.email }}</strong> è stata verificata con successo.</p>
        </div>
      } @else {
        <!-- Email non verificata -->
        <div class="unverified-status">
          <div class="warning-section">
            <mat-icon class="warning-icon">warning</mat-icon>
            <div>
              <h3>Email Non Verificata</h3>
              <p>
                Il tuo indirizzo email <strong>{{ currentUser?.email }}</strong> non è ancora verificato.
                Verifica la tua email per accedere a tutte le funzionalità.
              </p>
            </div>
          </div>

          <mat-divider></mat-divider>

          @if (!codeSent()) {
            <!-- Sezione per inviare il codice -->
            <div class="send-code-section">
              <p>Clicca sul pulsante qui sotto per ricevere un codice di verifica via email.</p>
              <button 
                mat-raised-button 
                color="primary"
                (click)="sendVerificationCode()"
                [disabled]="isSendingCode()">
                <mat-icon>send</mat-icon>
                @if (isSendingCode()) {
                  Invio in corso...
                } @else {
                  Invia Codice di Verifica
                }
              </button>
            </div>
          } @else {
            <!-- Form per inserire il codice -->
            <form [formGroup]="verifyEmailForm" (ngSubmit)="onSubmit()" class="verify-form">
              <div class="code-sent-info">
                <mat-icon>info</mat-icon>
                <p>
                  Abbiamo inviato un codice di verifica a <strong>{{ currentUser?.email }}</strong>.
                  Controlla la tua casella di posta e inserisci il codice qui sotto.
                </p>
              </div>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Codice di Verifica</mat-label>
                <input 
                  matInput
                  type="text"
                  formControlName="code"
                  placeholder="123456"
                  maxlength="6"
                  autocomplete="off">
                <mat-icon matPrefix>lock</mat-icon>
                <mat-error>{{ getErrorMessage('code') }}</mat-error>
              </mat-form-field>

              <div class="form-actions">
                <button 
                  mat-raised-button 
                  color="primary"
                  type="submit"
                  [disabled]="isLoading() || verifyEmailForm.invalid">
                  <mat-icon>check</mat-icon>
                  @if (isLoading()) {
                    Verifica in corso...
                  } @else {
                    Verifica Email
                  }
                </button>

                <button 
                  mat-button
                  type="button"
                  (click)="sendVerificationCode()"
                  [disabled]="isSendingCode()">
                  <mat-icon>refresh</mat-icon>
                  Reinvia Codice
                </button>
              </div>
            </form>
          }
        </div>
      }
    </mat-card-content>
  </mat-card>
</div>
